use LAB1;

EXEC sp_helpindex [AGENTS]
EXEC sp_help customer
EXEC sp_helpindex ORDERS

INSERT INTO ORDERS (ORD_NUM, ORD_AMOUNT, ADVANCE_AMOUNT, ORD_DATE, CUST_CODE, AGENT_CODE, ORD_DESCRIPTION)
VALUES
(1, 1000.00, 500.00, '2023-01-01', 'C00001', 'A001', 'Order for customer C00001'),
(2, 2000.00, 1000.00, '2023-01-02', 'C00002', 'A002', 'Order for customer C00002'),
(3, 3000.00, 1500.00, '2023-01-03', 'C00003', 'A003', 'Order for customer C00003'),
(4, 4000.00, 2000.00, '2023-01-04', 'C00004', 'A004', 'Order for customer C00004'),
(5, 5000.00, 2500.00, '2023-01-05', 'C00005', 'A005', 'Order for customer C00005');

INSERT INTO ORDERS (ORD_NUM, ORD_AMOUNT, ADVANCE_AMOUNT, ORD_DATE, CUST_CODE, AGENT_CODE, ORD_DESCRIPTION)
VALUES
(6, 6000.00, 3000.00, '2023-01-06', 'C00006', 'A006', 'Order for customer C00006'),
(7, 7000.00, 3500.00, '2023-01-07', 'C00007', 'A007', 'Order for customer C00007'),
(8, 8000.00, 4000.00, '2023-01-08', 'C00008', 'A008', 'Order for customer C00008'),
(9, 9000.00, 4500.00, '2023-01-09', 'C00009', 'A009', 'Order for customer C00009'),
(10, 10000.00, 5000.00, '2023-01-10', 'C00010', 'A010', 'Order for customer C00010'),
(11, 11000.00, 5500.00, '2023-01-11', 'C00011', 'A011', 'Order for customer C00011'),
(12, 12000.00, 6000.00, '2023-01-12', 'C00012', 'A012', 'Order for customer C00012'),
(13, 13000.00, 6500.00, '2023-01-13', 'C00013', 'A003', 'Order for customer C00013'),
(14, 14000.00, 7000.00, '2023-01-14', 'C00014', 'A001', 'Order for customer C00014'),
(15, 15000.00, 7500.00, '2023-01-15', 'C00015', 'A002', 'Order for customer C00015');


---1-----------------------------------------
SELECT C.CUST_NAME, A.AGENT_NAME, SUM(O.ORD_AMOUNT) AS TOTAL_ORD_AMOUNT
FROM CUSTOMER C
JOIN AGENTS A ON C.AGENT_CODE = A.AGENT_CODE
JOIN ORDERS O ON C.CUST_CODE = O.CUST_CODE
GROUP BY C.CUST_NAME, A.AGENT_NAME
HAVING SUM(O.ORD_AMOUNT) > 5000
ORDER BY C.CUST_NAME ASC;
---2-----------------------------------------
SELECT A.AGENT_NAME, C.CUST_COUNTRY, SUM(O.ORD_AMOUNT) AS TOTAL_ORD_AMOUNT
FROM AGENTS A
JOIN CUSTOMER C ON A.AGENT_CODE = C.AGENT_CODE
JOIN ORDERS O ON C.CUST_CODE = O.CUST_CODE
GROUP BY A.AGENT_NAME, C.CUST_COUNTRY
HAVING COUNT(DISTINCT C.CUST_COUNTRY) = 1
ORDER BY C.CUST_COUNTRY ASC;
---3-----------------------------------------
SELECT A.AGENT_NAME, C.CUST_NAME, SUM(O.ORD_AMOUNT) AS TOTAL_ORD_AMOUNT, C.OUTSTANDING_AMT
FROM AGENTS A
JOIN CUSTOMER C ON A.AGENT_CODE = C.AGENT_CODE
JOIN ORDERS O ON C.CUST_CODE = O.CUST_CODE
GROUP BY A.AGENT_NAME, C.CUST_NAME, C.OUTSTANDING_AMT
HAVING SUM(O.ORD_AMOUNT) > 10000 AND C.OUTSTANDING_AMT > 5000
ORDER BY A.AGENT_NAME ASC;
---4-----------------------------------------
SELECT AGENT_CODE, AGENT_NAME, WORKING_AREA, COMMISSION, PHONE_NO, COUNTRY
FROM AGENTS
WHERE COMMISSION > 0.12
ORDER BY COMMISSION DESC;
---5-----------------------------------------
SELECT SUM(ORD_AMOUNT) AS TOTAL_ORD_AMOUNT
FROM ORDERS
JOIN CUSTOMER ON ORDERS.CUST_CODE = CUSTOMER.CUST_CODE
JOIN AGENTS ON CUSTOMER.AGENT_CODE = AGENTS.AGENT_CODE
WHERE AGENTS.WORKING_AREA = 'London';
---6-----------------------------------------
SELECT ORD_NUM, ORD_AMOUNT, ADVANCE_AMOUNT, ORD_DATE, ORD_DESCRIPTION
FROM ORDERS
JOIN CUSTOMER ON ORDERS.CUST_CODE = CUSTOMER.CUST_CODE
WHERE CUSTOMER.AGENT_CODE = 'A003'
ORDER BY ORD_NUM ASC;



create index agents_commission_idx ON agents (commission)



